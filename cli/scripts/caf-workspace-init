#!/usr/bin/env bash
set -euo pipefail

session="${CAFAYE_TMUX_SESSION:-cafaye}"
attach=0

if [[ "${1:-}" == "--attach" ]]; then
  attach=1
fi

if ! command -v tmux >/dev/null 2>&1; then
  echo "tmux is not installed." >&2
  exit 1
fi

if ! tmux has-session -t "$session" 2>/dev/null; then
  tmux new-session -d -s "$session" -n dashboard
  tmux send-keys -t "${session}:dashboard" 'clear; command -v fastfetch >/dev/null && fastfetch || echo "â˜• Cafaye dashboard"' C-m
  tmux new-window -t "${session}:" -n terminal
  tmux new-window -t "${session}:" -n git
  tmux select-window -t "${session}:terminal"
fi

if [[ "$attach" -eq 1 ]]; then
  exec tmux attach -t "$session"
fi
