#!/usr/bin/env bash
set -euo pipefail

attach=0

if [[ "${1:-}" == "--attach" ]]; then
  attach=1
fi

if ! command -v tmux >/dev/null 2>&1; then
  echo "tmux is not installed." >&2
  exit 1
fi

if ! command -v caf-workspace-run >/dev/null 2>&1; then
  echo "caf-workspace-run is not installed." >&2
  exit 1
fi

caf-workspace-run
session="${CAFAYE_TMUX_SESSION:-cafaye}"

if [[ "$attach" -eq 1 ]]; then
  exec tmux attach -t "$session"
fi
